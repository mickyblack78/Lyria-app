<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lyria Engine</title>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; text-align: center; padding: 15px; }
        .box { border: 2px solid #0f0; padding: 15px; background: #111; }
        #display { background: #222; padding: 15px; margin-bottom: 10px; border: 1px solid #444; }
        .btn { width: 48%; margin: 4px 1%; padding: 20px; background: #000; color: #0f0; border: 2px solid #0f0; font-weight: bold; }
        input[type="file"] { background: #222; color: #0f0; width: 100%; padding: 20px; margin: 10px 0; border: 1px dashed #0f0; }
    </style>
</head>
<body>
    <div class="box">
        <h3>LYRIA CORE ENGINE</h3>
        <div id="display">READY: SELECT FILES</div>
        <input type="file" id="f-in" multiple>
        <button class="btn" onclick="play()">PLAY</button>
        <button class="btn" onclick="pause()">PAUSE</button>
        <button class="btn" onclick="next()">NEXT</button>
        <button class="btn" onclick="stop()">STOP</button>
        <hr style="border:1px solid #333; margin:15px 0;">
        <button class="btn" onclick="stitch()">STITCH ALL</button>
        <button class="btn" id="rec-btn" onclick="toggleRec()">REC</button>
        <button class="btn" onclick="speed(1.5)">1.5x</button>
        <button class="btn" onclick="speed(0.8)">0.8x</button>
    </div>
    <audio id="aud"></audio>
    <script>
        let a=document.getElementById('aud'), d=document.getElementById('display'), t=[], c=0, r, ch=[];
        document.getElementById('f-in').onchange=(e)=>{
            t=Array.from(e.target.files).map(f=>({b:f,u:URL.createObjectURL(f)}));
            d.innerText=t.length+" LOADED";
        };
        function play(){if(t[c]){a.src=t[c].u;a.play();d.innerText="TRACK "+(c+1);}}
        function pause(){a.pause();d.innerText="PAUSED";}
        function stop(){a.pause();a.currentTime=0;d.innerText="STOPPED";}
        function next(){c=(c+1)%t.length;play();}
        function speed(s){a.playbackRate=s;d.innerText="SPEED: "+s+"x";}
        a.onended=()=>{next();};
        function stitch(){
            if(t.length<1)return;
            let b=new Blob(t.map(i=>i.b),{type:'audio/mpeg'});
            let l=document.createElement('a');
            l.href=URL.createObjectURL(b);
            l.download="lyria_manual_export.mp3";
            l.click();
            d.innerText="STITCHED & SAVED";
        }
        async function toggleRec(){
            if(!r){
                let s=await navigator.mediaDevices.getUserMedia({audio:true});
                r=new MediaRecorder(s);
                r.ondataavailable=(e)=>ch.push(e.data);
                r.onstop=()=>{
                    let b=new Blob(ch,{type:'audio/ogg'});
                    let l=document.createElement('a');
                    l.href=URL.createObjectURL(b);
                    l.download="lyria_rec.ogg";
                    l.click();
                    ch=[];
                    d.innerText="REC SAVED";
                };
                r.start(); d.innerText="RECORDING...";
                document.getElementById('rec-btn').style.color="red";
            }else{
                r.stop(); r=null;
                document.getElementById('rec-btn').style.color="#0f0";
            }
        }
    </script>
</body>
</html>
